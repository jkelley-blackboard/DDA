<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Working with DDA</title>
  <link rel="icon" href="https://docs.anthology.com/img/favicon.ico" type="image/x-icon">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    /* ---- Color & Typography ---- */
    :root {
      --primary-color: #003366;
      --secondary-color: #0073aa;
      --hover-color: #004f7c;
      --light-gray: #f5f5f5;
      --border-gray: #e0e0e0;
      --text-dark: #2c2c2c;
      --content-max: 1200px;
      --sidebar-width: 240px;
    }

    body {
      font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif;
      background-color: #fff;
      color: var(--text-dark);
      margin: 0;
      line-height: 1.6;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    a {
      color: var(--secondary-color);
      text-decoration: none;
      transition: color 0.2s ease;
    }
    a:hover {
      color: var(--hover-color);
      text-decoration: underline;
    }

    h1, h2, h3 {
      color: #fff;
      font-weight: 500;
      margin: 0 0 0.5em 0;
    }
    h2, h3 {
      color: #1a1a1a;
    }
    p {
      margin: 0.6em 0;
    }

    /* ---- Header ---- */
    header {
      background-color: var(--primary-color);
      color: #fff;
      padding: 1em 0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .header-container {
      max-width: var(--content-max);
      margin: 0 auto;
      padding: 0 1em;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header h1 {
      font-size: 1.8em;
      color: #fff;
    }

    /* ---- Main layout ---- */
    .main-wrapper {
      display: flex;
      flex: 1;
      max-width: var(--content-max);
      margin: 1.25em auto;
      padding: 0 1em;
      gap: 1.25em;
      width: 100%;
    }

    /* ---- Sidebar ---- */
    .sidebar {
      width: var(--sidebar-width);
      padding: 1em;
      background-color: var(--light-gray);
      border-radius: 8px;
      border: 1px solid var(--border-gray);
      flex-shrink: 0;
      height: fit-content;
    }
    .sidebar h3 {
      font-size: 1.05em;
      margin-bottom: 0.75em;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .sidebar li {
      margin-bottom: 0.45em;
    }
    .sidebar a {
      display: block;
      padding: 0.35em 0.5em;
      border-radius: 6px;
      transition: background 0.15s ease;
    }
    .sidebar a:hover {
      background-color: #e8f0fe;
    }

    /* ---- Content ---- */
    main.content {
      flex: 1;
      padding: 0 1em;
    }
    .section {
      margin-bottom: 1.75em;
    }
    h2 {
      font-size: 1.35em;
      border-bottom: 1px solid var(--border-gray);
      padding-bottom: 0.3em;
      margin-top: 0.5em;
    }

    /* ---- Lists ---- */
    ul.nested {
      padding-left: 1.2em;
      margin-top: 0.5em;
    }
    ul.nested li {
      margin-bottom: 0.35em;
    }

    /* ---- Notes/Info ---- */
    .note {
      background-color: var(--light-gray);
      border-left: 4px solid var(--secondary-color);
      padding: 1em;
      margin: 1.25em 0;
      font-size: 0.95em;
      border-radius: 4px;
    }

    /* ---- Code blocks ---- */
    pre {
      background-color: #f4f4f4;
      padding: 0.75em;
      border-radius: 6px;
      overflow-x: auto;
      border: 1px solid #ddd;
      font-size: 0.95em;
      line-height: 1.4;
      margin: 0.6em 0;
    }
    code {
      font-family: Consolas, "Courier New", monospace;
      color: #333;
    }

    /* ---- Footer ---- */
    footer {
      background-color: #fafafa;
      color: #666;
      font-size: 0.9em;
      text-align: center;
      padding: 1em 0;
      border-top: 1px solid var(--border-gray);
      margin-top: auto;
    }

    /* ---- Responsive ---- */
    @media (max-width: 960px) {
      .main-wrapper {
        flex-direction: column;
        margin: 0.75em auto;
      }
      .sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid var(--border-gray);
      }
      header h1 {
        font-size: 1.4em;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-container">
      <h1>Working with DDA</h1>
    </div>
  </header>

  <div class="main-wrapper" role="main">
    <aside class="sidebar" aria-label="Site navigation">
      <h3>Navigation</h3>
      <ul>
        <li><a href="#official-docs">Official Docs</a></li>
        <li><a href="#schema-changes">Schema Packages</a></li>
        <li><a href="#schema-explorer">Schema Explorer</a></li>
        <li><a href="#repository">Repository</a></li>
        <li><a href="#dda-overview">DDA Database Overview</a></li>
        <li><a href="#dblink-joins">Cross-Database Joins</a></li>
      </ul>
    </aside>

    <main class="content">
      <section class="section" id="intro">
        <p>
          This site provides documentation and resources for working with Blackboard's
          <strong>Direct Data Access (DDA)</strong> service.
        </p>
      </section>

      <section class="section" id="official-docs">
        <h2>Official Documentation</h2>
        <p>
          Visit the official Blackboard Help page for DDA:<br>
          <a href="https://help.blackboard.com/Learn/Administrator/SaaS/Integrations/Direct_Data_Access" target="_blank" rel="noopener noreferrer">
            Direct Data Access - Blackboard Help
          </a>
        </p>

        <div class="note" aria-hidden="false">
          <strong>Important Note:</strong><br>
          Nothing in this repository supersedes your institution’s contract or Anthology’s official documentation.
          Anthology may make changes to the platform or DDA functionality that are not yet reflected here.
          Always consult the official documentation and your agreements before making decisions based on this content.
        </div>
      </section>

      <section class="section" id="schema-changes">
        <h2>Schema and Changes Packages</h2>
        <p>You can browse and download the latest database documentation packages here:</p>
        <ul class="nested" aria-label="Schema packages">
          <li><a href="https://bbprepo.blackboard.com/#browse/browse:releases:bbdn%2fschema" target="_blank" rel="noopener noreferrer">Schema Packages (bbprepo)</a></li>
          <li><a href="https://bbprepo.blackboard.com/#browse/browse:releases:bbdn%2fjdiff" target="_blank" rel="noopener noreferrer">Changes Packages (bbprepo)</a></li>
        </ul>
      </section>

      <section class="section" id="schema-explorer">
        <h2>Expanded Schema Explorer</h2>
        <p>
          You can explore the expanded schema package here:<br>
          <a href="./schema-3902.1.0/schema/index.html" target="_blank" rel="noopener noreferrer">schema-3902.1.0</a>
        </p>
      </section>

      <section class="section" id="repository">
        <h2>Repository</h2>
        <p>
          My GitHub repository contains SQL scripts and tools for working with DDA, including role audits,
          grade exports, and log summaries.<br>
          <a href="https://github.com/jkelley-blackboard/DDA" target="_blank" rel="noopener noreferrer">View Base Repository on GitHub</a>
        </p>
      </section>

      <section class="section" id="dda-overview">
        <h2>DDA Database Overview</h2>
        <p>
          Blackboard SaaS deployments use five distinct PostgreSQL databases to support core application functionality,
          reporting, and content management. This summary outlines their purpose and relevance for reporting and
          integration work. Schema details are primarily documented in the Expanded Schema Explorer section above.
        </p>

        <ul class="nested" aria-label="DDA databases">
          <li>
            <strong>BBxxxxxxxxxxxx</strong>
            <ul class="nested">
              <li>Primary production database</li>
              <li>Contains all core application tables (courses, users, enrollments, grades, hierarchy, tools, etc.)</li>
              <li>Most reporting and integration work will use this database</li>
              <li>Schema is mostly documented in the Expanded Schema Explorer above</li>
            </ul>
          </li>

          <li>
            <strong>BBxxxxxxxxxxxx_admin</strong>
            <ul class="nested">
              <li>System coordination database</li>
              <li>Stores internal configuration and metadata</li>
              <li>Rarely accessed for reporting or integrations</li>
            </ul>
          </li>

          <li>
            <strong>BBxxxxxxxxxxxx_stats</strong>
            <ul class="nested">
              <li>Reporting and analytics database</li>
              <li>Includes a permanent copy of <code>activity_accumulator</code>, which is truncated to 180 days in the production database</li>
              <li><code>ODS</code> tables contain transformed data specifically for activity reporting</li>
            </ul>
          </li>

          <li>
            <strong>BBxxxxxxxxxxxx_cms_doc</strong>
            <ul class="nested">
              <li>Content Collection document store</li>
              <li>Powers file storage and retrieval for the Content Collection</li>
              <li>Not documented and generally not used for reporting</li>
            </ul>
          </li>

          <li>
            <strong>BBxxxxxxxxxxxx_cms</strong>
            <ul class="nested">
              <li>Content Collection admin database</li>
              <li>Manages metadata and configuration for the Content Collection</li>
              <li>Rarely accessed and not typically relevant for reporting</li>
            </ul>
          </li>
        </ul>

        <div class="note">
          <strong>Note:</strong><br>
          Replace <code>BBxxxxxxxxxxxx</code> with your actual database prefix (for example, <code>BB5c1c67a3c99fc</code>).
          Some older systems may have been configured with individual <code>_cms</code> databases for each of the various root
          folders in the Content Collection (for example, <code>BBxxxxxxxxxxxx_cms_users</code> or <code>BBxxxxxxxxxxxx_cms_orgs</code>).
          The schema for these databases is the same as <code>_cms_doc</code>.
        </div>
      </section>

      <section class="section" id="dblink-joins">
        <h2>Cross-Database Joins with <code>dblink</code></h2>
        <p>
          Blackboard's DDA databases are physically separated, so direct joins between them require the use of
          PostgreSQL's <code>dblink</code> extension. This allows you to query across databases within the same
          PostgreSQL instance.
        </p>

        <ul class="nested">
          <li>
            <strong>Enable the extension:</strong>
            <pre><code>CREATE EXTENSION IF NOT EXISTS dblink;</code></pre>
          </li>

          <li>
            <strong>Basic usage:</strong>
            <p>Query another database like this:</p>
            <pre><code>SELECT * FROM dblink(
  'dbname=BBxxxxxxxxxxxx_stats user=bbuser password=bbpassword',
  'SELECT pk1, activity_date FROM activity_accumulator'
) AS aa(pk1 INT, activity_date TIMESTAMP);</code></pre>
          </li>

          <li>
            <strong>Join example:</strong>
            <p>Join data from <code>BBxxxxxxxxxxxx</code> and <code>BBxxxxxxxxxxxx_stats</code>:</p>
            <pre><code>SELECT u.pk1, u.user_id, aa.activity_date
FROM users u
JOIN dblink(
  'dbname=BBxxxxxxxxxxxx_stats user=bbuser password=bbpassword',
  'SELECT user_pk1, activity_date FROM activity_accumulator'
) AS aa(user_pk1 INT, activity_date TIMESTAMP)
ON u.pk1 = aa.user_pk1;</code></pre>
          </li>
        </ul>

        <div class="note">
          <strong>Note:</strong><br>
          <code>dblink</code> requires a valid username and password for the target database.
          In most Blackboard environments, connections are only permitted <strong>from the main database to others</strong>, not the reverse.
          This is a standard production security configuration and cannot be altered in those environments.
          Replace <code>BBxxxxxxxxxxxx</code> with your actual database prefix (for example, <code>BB5c1c67a3c99fc</code>).
        </div>
      </section>
    </main>
  </div>

  <footer>
    © 2025 Anthology Inc. | Blackboard Direct Data Access Resources<br>
    This documentation is provided "as is" without warranty of any kind.
  </footer>
</body>
</html>
